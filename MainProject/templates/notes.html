<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Notes App</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='notes.css') }}" />
</head>
<body>
    <div class="container">
        <h1>Daily Notes</h1>
        
        <div class="date-picker">
            <label for="noteDate">Select Date:</label>
            <input type="date" id="noteDate" onchange="loadNoteForDate()">
        </div>

        <div class="note-section">
            <textarea id="noteText" placeholder="Write your note for this day..."></textarea>
            <button onclick="saveNote()">Save Note</button>
            <button class="save-file-btn" onclick="saveToFile()">Save All Notes to File</button>
        </div>

        <div class="saved-notes">
            <h3>All Notes</h3>
            <div id="notesList"></div>
        </div>
    </div>

    <script>
        
        let notes = {};
        let currentDate = '';

        // Set today's date on load
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('noteDate').value = today;
            loadNoteForDate();
            displayAllNotes();
        });
        
        function loadNoteForDate() {
            currentDate = document.getElementById('noteDate').value;
            const noteText = document.getElementById('noteText');
           
            if (notes[currentDate]) {
                noteText.value = notes[currentDate];
            } else {
                noteText.value = '';
            }
        }
        
        function saveNote() {
            const noteText = document.getElementById('noteText').value;
           
            if (noteText.trim() === '') {
                if (notes[currentDate]) {
                    delete notes[currentDate];
                }
            } else {
                notes[currentDate] = noteText;
            }
           
            displayAllNotes();
        }
        
        function saveToFile() {
            // Check if there are any notes to save
            if (Object.keys(notes).length === 0) {
                alert('No notes to save!');
                return;
            }
            
            // Sort dates chronologically
            const sortedDates = Object.keys(notes).sort();
            
            // Create the text content
            let content = '';
            sortedDates.forEach(date => {
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                content += `${formattedDate}\n`;
                content += `${'='.repeat(formattedDate.length)}\n`;
                content += `${notes[date]}\n\n`;
            });
            
            // Create blob and download
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = initial_prompt.txt;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function displayAllNotes() {
            const notesList = document.getElementById('notesList');
            notesList.innerHTML = '';
            const sortedDates = Object.keys(notes).sort().reverse();
           
            if (sortedDates.length === 0) {
                notesList.innerHTML = '<p>No notes yet. Select a date and start writing!</p>';
                return;
            }
            
            sortedDates.forEach(date => {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'note-item';
               
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
               
                noteDiv.innerHTML = `
                    <div class="note-date">${formattedDate}</div>
                    <div class="note-content">${notes[date]}</div>
                    <button class="edit-btn" onclick="editNote('${date}')">Edit</button>
                    <button class="delete-btn" onclick="deleteNote('${date}')">Delete</button>
                `;
               
                notesList.appendChild(noteDiv);
            });
        }
        
        function editNote(date) {
            document.getElementById('noteDate').value = date;
            loadNoteForDate();
        }
        
        function deleteNote(date) {
            if (confirm('Are you sure you want to delete this note?')) {
                delete notes[date];
                displayAllNotes();
               
                // Clear textarea if we're currently viewing the deleted note
                if (currentDate === date) {
                    document.getElementById('noteText').value = '';
                }
            }
            
        }
        
        function submitPrompt() {
            const input = document.getElementById('promptInput').value.trim();
            const status = document.getElementById('promptStatus');
            if (!input) {
                status.textContent = "Please enter some text.";
                return;
            }
            fetch('/add_prompt', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: input })
            })
            .then(res => res.json())
            .then(data => {
                status.textContent = data.message;
                document.getElementById('promptInput').value = '';
            })
            .catch(() => {
                status.textContent = "Failed to add to prompt file.";
            });
        }
    </script>
</body>
</html>